<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CarspireOnline â€“ Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import {
      getAuth,
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword,
      GoogleAuthProvider,
      signInWithPopup
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    import {
      getFirestore,
      doc,
      getDoc,
      setDoc,
      collection,
      getDocs,
      runTransaction,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    /* ðŸ”¥ YOUR FIREBASE CONFIG */
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT",
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    /* ---------- CREATE USER WITH UNIQUE ID ---------- */
    async function createUserProfile(user, username) {
      const userRef = doc(db, "users", user.uid);

      await runTransaction(db, async (transaction) => {
        const counterRef = doc(db, "meta", "userCounter");
        const counterSnap = await transaction.get(counterRef);

        let newId = 1;
        if (counterSnap.exists()) {
          newId = counterSnap.data().value + 1;
          transaction.update(counterRef, { value: newId });
        } else {
          transaction.set(counterRef, { value: 1 });
        }

        transaction.set(userRef, {
          username,
          numericUserId: newId,
          createdAt: serverTimestamp()
        });
      });
    }

    /* ---------- LOGIN ---------- */
    window.login = async () => {
      const email = emailInput.value;
      const password = passwordInput.value;
      await signInWithEmailAndPassword(auth, email, password);
      alert("Logged in!");
    };

    /* ---------- SIGNUP ---------- */
    window.signup = async () => {
      const email = emailInput.value;
      const password = passwordInput.value;
      const username = usernameInput.value;

      const cred = await createUserWithEmailAndPassword(auth, email, password);
      await createUserProfile(cred.user, username);
      alert("Account created!");
    };

    /* ---------- GOOGLE LOGIN ---------- */
    window.googleLogin = async () => {
      const provider = new GoogleAuthProvider();
      const result = await signInWithPopup(auth, provider);

      const userDoc = doc(db, "users", result.user.uid);
      const snap = await getDoc(userDoc);

      if (!snap.exists()) {
        await createUserProfile(result.user, result.user.displayName);
      }

      alert("Logged in with Google!");
    };
  </script>
</head>

<body class="min-h-screen flex items-center justify-center bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500">

<div class="bg-white p-8 rounded-3xl shadow-xl w-full max-w-md">
  <h1 class="text-3xl font-bold text-center mb-6">CarspireOnline</h1>

  <input id="usernameInput" placeholder="Username (signup only)"
    class="w-full p-3 border rounded-xl mb-3">

  <input id="emailInput" placeholder="Email"
    class="w-full p-3 border rounded-xl mb-3">

  <input id="passwordInput" type="password" placeholder="Password"
    class="w-full p-3 border rounded-xl mb-4">

  <button onclick="login()" class="w-full bg-indigo-600 text-white p-3 rounded-xl mb-2">
    Login
  </button>

  <button onclick="signup()" class="w-full bg-green-600 text-white p-3 rounded-xl mb-2">
    Sign Up
  </button>

  <button onclick="googleLogin()" class="w-full bg-red-500 text-white p-3 rounded-xl">
    Continue with Google
  </button>
</div>

</body>
</html>
