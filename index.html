<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CarspireOnline â€“ Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen flex items-center justify-center bg-gradient-to-br from-indigo-600 to-purple-600">

<div class="bg-white w-full max-w-md p-8 rounded-3xl shadow-xl">
  <h1 class="text-3xl font-bold text-center mb-6">CarspireOnline</h1>

  <!-- LOGIN FORM -->
  <div id="loginForm">
    <input id="loginUsername" placeholder="Username"
      class="w-full p-3 border rounded-xl mb-3">

    <input id="loginPassword" type="password" placeholder="Password"
      class="w-full p-3 border rounded-xl mb-4">

    <button id="loginBtn"
      class="w-full bg-indigo-600 text-white p-3 rounded-xl mb-3">
      Login
    </button>

    <button id="googleBtn"
      class="w-full bg-red-500 text-white p-3 rounded-xl mb-4">
      Continue with Google
    </button>

    <p class="text-center text-sm">
      Donâ€™t have an account?
      <span id="showSignup" class="text-indigo-600 cursor-pointer font-semibold">
        Sign up
      </span>
    </p>
  </div>

  <!-- SIGNUP FORM -->
  <div id="signupForm" class="hidden">
    <input id="signupUsername" placeholder="Username"
      class="w-full p-3 border rounded-xl mb-3">

    <input id="signupEmail" placeholder="Email"
      class="w-full p-3 border rounded-xl mb-3">

    <input id="signupPassword" type="password" placeholder="Password"
      class="w-full p-3 border rounded-xl mb-4">

    <button id="signupBtn"
      class="w-full bg-green-600 text-white p-3 rounded-xl mb-4">
      Create Account
    </button>

    <p class="text-center text-sm">
      Already have an account?
      <span id="showLogin" class="text-indigo-600 cursor-pointer font-semibold">
        Login
      </span>
    </p>
  </div>
</div>

<!-- ðŸ”¥ FIREBASE LOGIC -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import {
    getAuth,
    signInWithEmailAndPassword,
    createUserWithEmailAndPassword,
    GoogleAuthProvider,
    signInWithPopup
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  import {
    getFirestore,
    doc,
    getDoc,
    runTransaction,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  /* ðŸ”§ CONFIG (REPLACE THIS) */
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  /* UI TOGGLE */
  const loginForm = document.getElementById("loginForm");
  const signupForm = document.getElementById("signupForm");

  document.getElementById("showSignup").onclick = () => {
    loginForm.classList.add("hidden");
    signupForm.classList.remove("hidden");
  };

  document.getElementById("showLogin").onclick = () => {
    signupForm.classList.add("hidden");
    loginForm.classList.remove("hidden");
  };

  /* LOGIN */
  document.getElementById("loginBtn").onclick = async () => {
    const username = loginUsername.value;
    const password = loginPassword.value;

    const email = `${username}@carspire.app`;

    await signInWithEmailAndPassword(auth, email, password);
    alert("Logged in!");
  };

  /* SIGNUP */
  document.getElementById("signupBtn").onclick = async () => {
    const username = signupUsername.value;
    const email = signupEmail.value;
    const password = signupPassword.value;

    const cred = await createUserWithEmailAndPassword(auth, email, password);

    await runTransaction(db, async (tx) => {
      const counterRef = doc(db, "meta", "userCounter");
      const userRef = doc(db, "users", cred.user.uid);

      const counterSnap = await tx.get(counterRef);
      const newId = counterSnap.exists() ? counterSnap.data().value + 1 : 1;

      tx.set(counterRef, { value: newId });
      tx.set(userRef, {
        username,
        userId: newId,
        createdAt: serverTimestamp()
      });
    });

    alert("Account created!");
  };

  /* GOOGLE LOGIN */
  document.getElementById("googleBtn").onclick = async () => {
    const provider = new GoogleAuthProvider();
    const result = await signInWithPopup(auth, provider);

    const userRef = doc(db, "users", result.user.uid);
    const snap = await getDoc(userRef);

    if (!snap.exists()) {
      await runTransaction(db, async (tx) => {
        const counterRef = doc(db, "meta", "userCounter");
        const counterSnap = await tx.get(counterRef);
        const newId = counterSnap.exists() ? counterSnap.data().value + 1 : 1;

        tx.set(counterRef, { value: newId });
        tx.set(userRef, {
          username: result.user.displayName,
          userId: newId,
          createdAt: serverTimestamp()
        });
      });
    }

    alert("Logged in with Google!");
  };
</script>

</body>
</html>
